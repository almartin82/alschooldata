---
title: "15 Insights from Alabama School Enrollment Data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{15 Insights from Alabama School Enrollment Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  fig.width = 8,
  fig.height = 5,
  cache = TRUE
)
```

```{r load-packages}
library(alschooldata)
library(dplyr)
library(tidyr)
library(ggplot2)

theme_set(theme_minimal(base_size = 14))
```

This vignette explores Alabama's public school enrollment data from the Alabama State Department of Education (ALSDE), covering the 2021-2025 school years. All data comes directly from the [ALSDE Federal Report Card](https://reportcard.alsde.edu/).

---

## 1. Alabama lost 12,000 students in four years

Despite a post-COVID bounce in 2022, Alabama's K-12 enrollment has declined from 730,000 to 717,000 since 2021.

```{r statewide-trend}
enr <- fetch_enr_multi(2021:2025, use_cache = TRUE)

state_totals <- enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(end_year, n_students) |>
  arrange(end_year) |>
  mutate(change = n_students - lag(n_students),
         pct_change = round(change / lag(n_students) * 100, 1))

stopifnot(nrow(state_totals) > 0)
state_totals
```

```{r statewide-chart}
ggplot(state_totals, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#9B1B30") +
  geom_point(size = 3, color = "#9B1B30") +
  geom_vline(xintercept = 2021, linetype = "dashed", color = "gray60", linewidth = 0.5) +
  annotate("text", x = 2021.3, y = 738000, label = "COVID\nrecovery",
           color = "gray50", size = 3, hjust = 0) +
  scale_y_continuous(labels = scales::comma, limits = c(710000, 740000)) +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Alabama Public School Enrollment (2021-2025)",
    subtitle = "Post-COVID bounce in 2022 followed by steady decline",
    x = "School Year (ending)",
    y = "Total Enrollment"
  )
```

---

## 2. Hispanic enrollment grew 27% in four years

Hispanic students are the fastest-growing demographic, rising from 9.5% to 12.2% of enrollment since 2021.

```{r hispanic-trend}
hispanic_trend <- enr |>
  filter(is_state, subgroup == "hispanic", grade_level == "TOTAL") |>
  mutate(pct = round(pct * 100, 1)) |>
  select(end_year, n_students, pct) |>
  arrange(end_year)

stopifnot(nrow(hispanic_trend) > 0)
hispanic_trend
```

```{r hispanic-chart}
ggplot(hispanic_trend, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#2E8B57") +
  geom_point(size = 3, color = "#2E8B57") +
  scale_y_continuous(labels = scales::comma) +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Hispanic Student Enrollment in Alabama (2021-2025)",
    subtitle = "From 69,000 to 88,000 students in four years",
    x = "School Year (ending)",
    y = "Number of Hispanic Students"
  )
```

---

## 3. Mobile County leads with 47,000 students

Alabama has 153 school systems. Mobile County enrolls 40% more than Jefferson County, the second-largest district.

```{r top-districts}
enr_2025 <- enr |> filter(end_year == 2025)

top_10 <- enr_2025 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  arrange(desc(n_students)) |>
  head(10) |>
  select(district_name, n_students)

stopifnot(nrow(top_10) > 0)
top_10
```

```{r top-districts-chart}
top_10 |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name)) +
  geom_col(fill = "#9B1B30") +
  scale_x_continuous(labels = scales::comma) +
  labs(
    title = "Alabama's 10 Largest School Systems (2024-25)",
    x = "Total Enrollment",
    y = NULL
  )
```

---

## 4. Birmingham shrinks while suburbs hold steady

Birmingham City lost 2,200 students since 2021 while nearby Homewood and Trussville grew and others held flat.

```{r birmingham-suburbs}
bham_districts <- c("Birmingham City", "Hoover City",
                    "Vestavia Hills City", "Mountain Brook City",
                    "Homewood City", "Trussville City")

bham_area <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         district_name %in% bham_districts) |>
  select(end_year, district_name, n_students) |>
  pivot_wider(names_from = end_year, values_from = n_students,
              values_fn = max)

stopifnot(nrow(bham_area) > 0)
bham_area
```

```{r suburb-chart}
enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         district_name %in% bham_districts) |>
  ggplot(aes(x = end_year, y = n_students, color = district_name)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  geom_vline(xintercept = 2021, linetype = "dashed", color = "gray60", linewidth = 0.5) +
  annotate("text", x = 2021.15, y = 22500, label = "COVID era",
           color = "gray50", size = 3, hjust = 0) +
  scale_y_continuous(labels = scales::comma) +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Birmingham Metro Enrollment Trends (2021-2025)",
    subtitle = "Birmingham City declines while suburbs grow or hold steady",
    x = "School Year",
    y = "Enrollment",
    color = "District"
  )
```

---

## 5. Black Belt lost nearly 1 in 5 students since 2021

Eight Black Belt counties lost 19% of their combined enrollment in just four years, from 13,100 to 10,600 students.

```{r black-belt}
bb_counties <- c("Perry County", "Wilcox County", "Greene County",
                 "Sumter County", "Lowndes County", "Macon County",
                 "Dallas County", "Hale County")

bb_trend <- enr |>
  filter(is_district, district_name %in% bb_counties,
         subgroup == "total_enrollment", grade_level == "TOTAL") |>
  group_by(end_year) |>
  summarize(total = sum(n_students), .groups = "drop") |>
  arrange(end_year) |>
  mutate(pct_from_2021 = round((total / first(total) - 1) * 100, 1))

stopifnot(nrow(bb_trend) > 0)
bb_trend
```

```{r black-belt-chart}
ggplot(bb_trend, aes(x = end_year, y = total)) +
  geom_line(linewidth = 1.2, color = "#8B4513") +
  geom_point(size = 3, color = "#8B4513") +
  scale_y_continuous(labels = scales::comma) +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Combined Enrollment in 8 Black Belt Counties",
    subtitle = "Down 19% in four years — from 13,100 to 10,600 students",
    x = "School Year",
    y = "Total Enrollment"
  )
```

---

## 6. Alabama is 56% white, 32% Black, 12% Hispanic

White students are the majority but their share has dropped from 58% to 56% since 2021 as Hispanic enrollment grows.

```{r demographics}
demographics <- enr_2025 |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("white", "black", "hispanic", "asian",
                         "multiracial", "native_american",
                         "pacific_islander")) |>
  mutate(pct = round(pct * 100, 1)) |>
  select(subgroup, n_students, pct) |>
  arrange(desc(n_students))

stopifnot(nrow(demographics) > 0)
demographics
```

```{r demographics-chart}
demographics |>
  mutate(subgroup = forcats::fct_reorder(subgroup, n_students)) |>
  ggplot(aes(x = n_students, y = subgroup, fill = subgroup)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(pct, "%")), hjust = -0.1, size = 3.5) +
  scale_x_continuous(labels = scales::comma,
                     expand = expansion(mult = c(0, 0.15))) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Alabama Student Demographics (2024-25)",
    x = "Number of Students",
    y = NULL
  )
```

---

## 7. The white share is falling 0.5 points per year

White enrollment dropped from 58.3% in 2021 to 56.1% in 2025 as the student body diversifies.

```{r demographic-shift}
demo_shares <- enr |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("white", "black", "hispanic")) |>
  mutate(pct = round(pct * 100, 1)) |>
  select(end_year, subgroup, pct) |>
  pivot_wider(names_from = subgroup, values_from = pct) |>
  arrange(end_year)

stopifnot(nrow(demo_shares) > 0)
demo_shares
```

```{r demographic-shift-chart}
enr |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("white", "black", "hispanic")) |>
  mutate(pct = round(pct * 100, 1),
         subgroup = factor(subgroup, levels = c("white", "black", "hispanic"),
                          labels = c("White", "Black", "Hispanic"))) |>
  ggplot(aes(x = end_year, y = pct, color = subgroup)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  scale_x_continuous(breaks = 2021:2025) +
  scale_color_manual(values = c("White" = "#4169E1", "Black" = "#9B1B30",
                                "Hispanic" = "#2E8B57")) +
  labs(
    title = "Racial/Ethnic Composition of Alabama Schools (2021-2025)",
    subtitle = "White share declining, Hispanic share growing rapidly",
    x = "School Year",
    y = "Percent of Total Enrollment",
    color = "Race/Ethnicity"
  )
```

---

## 8. Madison City grew 9% on Huntsville's tech boom

Madison City added 1,100 students since 2021 and Madison County grew 5%, even as Huntsville City itself declined 2%.

```{r madison-growth}
madison_area <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         district_name %in% c("Madison City", "Madison County", "Huntsville City")) |>
  select(end_year, district_name, n_students) |>
  pivot_wider(names_from = end_year, values_from = n_students, values_fn = max) |>
  mutate(change = `2025` - `2021`,
         pct_change = round((`2025` / `2021` - 1) * 100, 1))

stopifnot(nrow(madison_area) > 0)
madison_area
```

```{r madison-chart}
enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         district_name %in% c("Madison City", "Madison County", "Huntsville City")) |>
  ggplot(aes(x = end_year, y = n_students, color = district_name)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  scale_y_continuous(labels = scales::comma) +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Huntsville Metro Enrollment (2021-2025)",
    subtitle = "Madison City growing fastest on tech corridor expansion",
    x = "School Year",
    y = "Enrollment",
    color = "District"
  )
```

---

## 9. Economically disadvantaged share swung from 48% to 65% and back

Alabama's economic disadvantage rate has been volatile -- dropping to 48% in 2022, spiking to 65% in 2023, and settling at 59% in 2025, likely reflecting shifts in eligibility methodology.

```{r econ-disadv}
econ_trend <- enr |>
  filter(is_state, grade_level == "TOTAL", subgroup == "econ_disadv") |>
  mutate(pct = round(pct * 100, 1)) |>
  select(end_year, n_students, pct) |>
  arrange(end_year)

stopifnot(nrow(econ_trend) > 0)
econ_trend
```

```{r econ-chart}
ggplot(econ_trend, aes(x = end_year, y = pct)) +
  geom_line(linewidth = 1.2, color = "#D2691E") +
  geom_point(size = 3, color = "#D2691E") +
  geom_hline(yintercept = 50, linetype = "dashed", color = "gray50") +
  annotate("text", x = 2021.5, y = 48, label = "50% line", color = "gray50") +
  annotate("text", x = 2023, y = 67, label = "Reporting\nmethodology\nchange?",
           color = "gray50", size = 3) +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Economically Disadvantaged Students in Alabama",
    subtitle = "Volatile trend may reflect changes in eligibility determination methods",
    x = "School Year",
    y = "Percent of Total Enrollment"
  )
```

---

## 10. English Learners grew 52% in four years

EL enrollment surged from 33,600 to 51,100 students, the fastest growth of any subgroup.

```{r el-trend}
el_trend <- enr |>
  filter(is_state, subgroup == "lep", grade_level == "TOTAL") |>
  mutate(pct = round(pct * 100, 1)) |>
  select(end_year, n_students, pct) |>
  arrange(end_year)

stopifnot(nrow(el_trend) > 0)
el_trend
```

```{r el-chart}
ggplot(el_trend, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#4169E1") +
  geom_point(size = 3, color = "#4169E1") +
  scale_y_continuous(labels = scales::comma) +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "English Learner Enrollment in Alabama (2021-2025)",
    subtitle = "From 33,600 to 51,100 students — up 52% in four years",
    x = "School Year",
    y = "Number of EL Students"
  )
```

---

## 11. Mobile County lost 5,800 students in four years

Alabama's largest district is shrinking faster than the state average, losing 11% of enrollment since 2021.

```{r mobile-trend}
mobile_trend <- enr |>
  filter(is_district, district_name == "Mobile County",
         subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(end_year, n_students) |>
  arrange(end_year) |>
  mutate(pct_from_2021 = round((n_students / first(n_students) - 1) * 100, 1))

stopifnot(nrow(mobile_trend) > 0)
mobile_trend
```

```{r mobile-chart}
ggplot(mobile_trend, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#9B1B30") +
  geom_point(size = 3, color = "#9B1B30") +
  scale_y_continuous(labels = scales::comma) +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Mobile County Enrollment (2021-2025)",
    subtitle = "From 53,100 to 47,400 — down 11% in four years",
    x = "School Year",
    y = "Total Enrollment"
  )
```

---

## 12. Special education spiked to 131,000 then fell back to 104,000

Students with disabilities jumped from 102,000 to 131,000 in 2022 -- likely post-pandemic catch-up identification -- then dropped back to 104,000 by 2025.

```{r sped-trend}
sped_trend <- enr |>
  filter(is_state, subgroup == "special_ed", grade_level == "TOTAL") |>
  mutate(pct = round(pct * 100, 1)) |>
  select(end_year, n_students, pct) |>
  arrange(end_year)

stopifnot(nrow(sped_trend) > 0)
sped_trend
```

```{r sped-chart}
ggplot(sped_trend, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#8B4513") +
  geom_point(size = 3, color = "#8B4513") +
  geom_vline(xintercept = 2022, linetype = "dashed", color = "gray60", linewidth = 0.5) +
  annotate("text", x = 2022.15, y = 108000, label = "Post-COVID\nidentification surge",
           color = "gray50", size = 3, hjust = 0) +
  scale_y_continuous(labels = scales::comma) +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Students with Disabilities in Alabama (2021-2025)",
    subtitle = "Sharp increase in 2022 may reflect post-pandemic catch-up identification",
    x = "School Year",
    y = "Number of Students"
  )
```

---

## 13. 9th grade is the largest class — 5,800 more than 12th

The "9th grade bulge" reflects retention policies, with 56,600 freshmen versus 50,800 seniors in 2025.

```{r grade-distribution}
grade_dist <- enr_2025 |>
  filter(is_state, subgroup == "total_enrollment",
         grade_level %in% c("PK", "K", "01", "02", "03", "04", "05",
                            "06", "07", "08", "09", "10", "11", "12")) |>
  mutate(grade_level = factor(grade_level,
                              levels = c("PK", "K", "01", "02", "03", "04", "05",
                                        "06", "07", "08", "09", "10", "11", "12"))) |>
  select(grade_level, n_students)

stopifnot(nrow(grade_dist) > 0)
grade_dist
```

```{r grade-chart}
ggplot(grade_dist, aes(x = grade_level, y = n_students)) +
  geom_col(fill = "#9B1B30") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Enrollment by Grade Level (2024-25)",
    subtitle = "9th grade shows the characteristic retention 'bulge'",
    x = "Grade Level",
    y = "Number of Students"
  )
```

---

## 14. Eufaula City grew 49% -- the fastest in the state

Eufaula City added nearly 2,900 students since 2021, making it the fastest-growing district by percentage.

```{r fastest-growing}
growth <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         end_year %in% c(2021, 2025)) |>
  select(end_year, district_name, n_students) |>
  pivot_wider(names_from = end_year, values_from = n_students,
              values_fn = max) |>
  filter(!is.na(`2021`) & !is.na(`2025`) & `2021` > 500) |>
  mutate(change = `2025` - `2021`,
         pct_change = round((`2025` / `2021` - 1) * 100, 1)) |>
  arrange(desc(pct_change)) |>
  head(10) |>
  select(district_name, `2021`, `2025`, change, pct_change)

stopifnot(nrow(growth) > 0)
growth
```

```{r growth-chart}
growth |>
  mutate(district_name = forcats::fct_reorder(district_name, pct_change)) |>
  ggplot(aes(x = pct_change, y = district_name)) +
  geom_col(fill = "#2E8B57") +
  geom_text(aes(label = paste0("+", pct_change, "%")), hjust = -0.1, size = 3.5) +
  scale_x_continuous(expand = expansion(mult = c(0, 0.15))) +
  labs(
    title = "Fastest-Growing Alabama Districts (2021-2025)",
    subtitle = "Minimum 500 students in 2021",
    x = "Percent Change",
    y = NULL
  )
```

---

## 15. Perry County lost a third of its students

The steepest decline is in Perry County, which dropped from 1,148 to 778 students — a 32% loss since 2021.

```{r most-declining}
decline <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         end_year %in% c(2021, 2025)) |>
  select(end_year, district_name, n_students) |>
  pivot_wider(names_from = end_year, values_from = n_students,
              values_fn = max) |>
  filter(!is.na(`2021`) & !is.na(`2025`) & `2021` > 500) |>
  mutate(change = `2025` - `2021`,
         pct_change = round((`2025` / `2021` - 1) * 100, 1)) |>
  arrange(pct_change) |>
  head(10) |>
  select(district_name, `2021`, `2025`, change, pct_change)

stopifnot(nrow(decline) > 0)
decline
```

```{r decline-chart}
decline |>
  mutate(district_name = forcats::fct_reorder(district_name, -pct_change)) |>
  ggplot(aes(x = pct_change, y = district_name)) +
  geom_col(fill = "#9B1B30") +
  geom_text(aes(label = paste0(pct_change, "%")), hjust = 1.1, color = "white", size = 3.5) +
  scale_x_continuous(expand = expansion(mult = c(0.05, 0))) +
  labs(
    title = "Fastest-Declining Alabama Districts (2021-2025)",
    subtitle = "Minimum 500 students in 2021",
    x = "Percent Change",
    y = NULL
  )
```

---

## Summary

Alabama's school enrollment data reveals a state in demographic transition:

- **Overall decline** from 730,000 to 717,000 students since 2021
- **Hispanic growth** is the dominant demographic trend (+27% in 4 years)
- **English Learner surge** mirrors Hispanic growth (+52% since 2021)
- **Urban-to-suburban shift** continues around Birmingham and Huntsville
- **Black Belt crisis** -- rural counties losing 19% of enrollment in 4 years
- **Special ed volatility** -- identification surged post-COVID then returned to baseline
- **Poverty data instability** -- economically disadvantaged share swung from 48% to 65%

---

### Data Notes

- **Source:** Alabama State Department of Education (ALSDE) [Federal Report Card](https://reportcard.alsde.edu/)
- **Years available:** 2015-2025 (this analysis uses 2021-2025)
- **Entities:** ~153 school systems, ~1,400 schools
- **Suppression:** Counts below 5 are marked with `*` or `~` to protect student privacy
- **Reporting:** Data reflects Census Day enrollment for each school year
- **Race/ethnicity overlap:** Federal reporting counts Hispanic/Latino as an ethnicity overlay on race, so racial category totals may exceed total enrollment
- **Economic disadvantage volatility:** The economically disadvantaged share shifted significantly across years (48%-65%), likely reflecting changes in Alabama's eligibility determination methodology
- **Special education spike:** The 2022-2024 special education surge and subsequent drop likely reflects post-COVID catch-up identification followed by reclassification

---

*Part of the [state schooldata](https://github.com/almartin82/njschooldata) project.*

---

```{r session-info}
sessionInfo()
```
