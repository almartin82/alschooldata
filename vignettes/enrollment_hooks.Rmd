---
title: "15 Insights from Alabama School Enrollment Data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{15 Insights from Alabama School Enrollment Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  fig.width = 8,
  fig.height = 5,
  cache = TRUE
)
```

```{r load-packages}
library(alschooldata)
library(dplyr)
library(tidyr)
library(ggplot2)

theme_set(theme_minimal(base_size = 14))
```

This vignette explores Alabama's public school enrollment data from the Alabama State Department of Education (ALSDE), covering 5 years (2021-2025) of campus-level data across 153 districts and 1,362 schools.

---

## 1. Alabama lost 12,000 students since 2022

Statewide enrollment peaked at 735,808 in 2022 and has since declined by over 18,000 students. The 2024 drop of 11,073 was the steepest single-year decline.

```{r statewide-trend}
enr <- fetch_enr_multi(2021:2025, use_cache = TRUE)

state_totals <- enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(end_year, n_students) |>
  arrange(end_year) |>
  mutate(change = n_students - lag(n_students),
         pct_change = round(change / lag(n_students) * 100, 2))

stopifnot(nrow(state_totals) > 0)
state_totals
```

```{r statewide-chart}
ggplot(state_totals, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#9B1B30") +
  geom_point(size = 3, color = "#9B1B30") +
  scale_y_continuous(labels = scales::comma, limits = c(710000, 740000)) +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Alabama Public School Enrollment (2021-2025)",
    subtitle = "Enrollment peaked in 2022 and has declined since",
    x = "School Year (ending)",
    y = "Total Enrollment"
  )
```

---

## 2. Hispanic enrollment surged from 9.5% to 12.2% in four years

Hispanic students are the fastest-growing racial/ethnic group in Alabama schools, adding nearly 19,000 students since 2021 while overall enrollment declined.

```{r hispanic-trend}
hispanic <- enr |>
  filter(is_state, subgroup == "hispanic", grade_level == "TOTAL") |>
  mutate(pct = round(pct * 100, 1)) |>
  select(end_year, n_students, pct) |>
  arrange(end_year)

stopifnot(nrow(hispanic) > 0)
hispanic
```

```{r hispanic-chart}
ggplot(hispanic, aes(x = end_year, y = pct)) +
  geom_line(linewidth = 1.2, color = "#2E8B57") +
  geom_point(size = 3, color = "#2E8B57") +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Hispanic Student Share in Alabama Schools",
    subtitle = "Growing from 9.5% to 12.2% of total enrollment",
    x = "School Year",
    y = "Percent of Total Enrollment"
  )
```

---

## 3. Mobile County is Alabama's largest system -- and shrinking fastest

Mobile County Public Schools serves 47,366 students, nearly 14,000 more than second-place Jefferson County. But Mobile has lost 5,768 students since 2021, a decline of 10.9%.

```{r top-districts}
enr_2025 <- enr |> filter(end_year == 2025)

top_10 <- enr_2025 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  arrange(desc(n_students)) |>
  head(10) |>
  select(district_name, n_students)

stopifnot(nrow(top_10) > 0)
top_10
```

```{r top-districts-chart}
top_10 |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name)) +
  geom_col(fill = "#9B1B30") +
  scale_x_continuous(labels = scales::comma) +
  labs(
    title = "Alabama's 10 Largest School Systems (2025)",
    x = "Total Enrollment",
    y = NULL
  )
```

---

## 4. Black Belt counties are hemorrhaging students

Perry County has lost 32% of its enrollment since 2021 -- the steepest decline of any Alabama district with 500+ students. Sumter County lost 29%, and Selma City lost 24%.

```{r fastest-decline}
decline <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         end_year %in% c(2021, 2025)) |>
  select(end_year, district_name, n_students) |>
  pivot_wider(names_from = end_year, values_from = n_students) |>
  filter(!is.na(`2021`), !is.na(`2025`), `2021` >= 500) |>
  mutate(change = `2025` - `2021`,
         pct_change = round((`2025` / `2021` - 1) * 100, 1)) |>
  arrange(pct_change) |>
  head(10)

stopifnot(nrow(decline) > 0)
decline
```

```{r decline-chart}
decline |>
  mutate(district_name = forcats::fct_reorder(district_name, pct_change)) |>
  ggplot(aes(x = pct_change, y = district_name)) +
  geom_col(fill = "#B22222") +
  geom_text(aes(label = paste0(pct_change, "%")), hjust = 1.1, color = "white", size = 3.5) +
  labs(
    title = "Alabama's Fastest-Declining Districts (2021-2025)",
    subtitle = "Districts with 500+ students in 2021",
    x = "Percent Change",
    y = NULL
  )
```

---

## 5. Alabama's student body: 56% white, 32% Black, 12% Hispanic

Alabama's racial demographics are shifting. White students still form the majority but their share dropped from 58.3% to 56.1% since 2021, while Hispanic and multiracial shares both grew.

```{r demographics}
demographics <- enr_2025 |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("white", "black", "hispanic", "asian",
                         "native_american", "pacific_islander", "multiracial")) |>
  mutate(pct = round(pct * 100, 1)) |>
  select(subgroup, n_students, pct) |>
  arrange(desc(n_students))

stopifnot(nrow(demographics) > 0)
demographics
```

```{r demographics-chart}
demographics |>
  mutate(subgroup = forcats::fct_reorder(subgroup, n_students)) |>
  ggplot(aes(x = n_students, y = subgroup, fill = subgroup)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(pct, "%")), hjust = -0.1) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Alabama Student Demographics (2025)",
    x = "Number of Students",
    y = NULL
  )
```

---

## 6. Nearly 3 in 5 Alabama students are economically disadvantaged

The economically disadvantaged rate jumped from 51% in 2021 to 65% in 2023, then settled at 59% in 2025. This volatility may reflect changes in reporting methodology rather than true poverty shifts.

```{r econ-disadv}
econ <- enr |>
  filter(is_state, grade_level == "TOTAL", subgroup == "econ_disadv") |>
  mutate(pct = round(pct * 100, 1)) |>
  select(end_year, n_students, pct) |>
  arrange(end_year)

stopifnot(nrow(econ) > 0)
econ
```

```{r econ-chart}
ggplot(econ, aes(x = end_year, y = pct)) +
  geom_line(linewidth = 1.2, color = "#8B4513") +
  geom_point(size = 3, color = "#8B4513") +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Economically Disadvantaged Students in Alabama",
    subtitle = "Rate jumped sharply in 2023, possibly reflecting reporting changes",
    x = "School Year",
    y = "Percent of Total Enrollment"
  )
```

---

## 7. Birmingham City lost 2,191 students in four years

Birmingham City Schools has shed students every single year since 2021, dropping from 21,901 to 19,710 -- a 10% decline. Once a top-5 Alabama district, it now ranks 8th.

```{r birmingham}
bham <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Birmingham City", district_name)) |>
  select(end_year, n_students) |>
  arrange(end_year) |>
  mutate(change = n_students - lag(n_students))

stopifnot(nrow(bham) > 0)
bham
```

```{r birmingham-chart}
ggplot(bham, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#9B1B30") +
  geom_point(size = 3, color = "#9B1B30") +
  scale_y_continuous(labels = scales::comma) +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Birmingham City Schools Enrollment (2021-2025)",
    subtitle = "Consistent decline: down 2,191 students (-10%)",
    x = "School Year",
    y = "Total Enrollment"
  )
```

---

## 8. Virtual schools exploded to 20,000 students

Alabama's virtual schools grew from 12,741 students (8 schools) in 2021 to 19,963 students (16 schools) in 2025. Alabama Connections Academy alone enrolls 7,339, making Limestone County appear to be one of the state's largest districts.

```{r virtual-schools}
virtual <- enr |>
  filter(is_campus, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Virtual|Connections|Destinations", campus_name, ignore.case = TRUE)) |>
  group_by(end_year) |>
  summarize(n_schools = n(), total_students = sum(n_students), .groups = "drop") |>
  arrange(end_year)

stopifnot(nrow(virtual) > 0)
virtual
```

```{r virtual-chart}
ggplot(virtual, aes(x = end_year, y = total_students)) +
  geom_line(linewidth = 1.2, color = "#4169E1") +
  geom_point(size = 3, color = "#4169E1") +
  geom_text(aes(label = paste0(n_schools, " schools")), vjust = -1.2, size = 3.5) +
  scale_y_continuous(labels = scales::comma) +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Virtual School Enrollment in Alabama",
    subtitle = "Nearly 20,000 students across 16 virtual schools",
    x = "School Year",
    y = "Total Virtual Enrollment"
  )
```

---

## 9. Multiracial students are the fastest-growing demographic

Students identifying as multiracial grew from 25,456 (3.5%) to 42,305 (5.9%) since 2021 -- a 66% increase. At this pace, multiracial students will outnumber Asian and Native American students combined.

```{r multiracial}
multi <- enr |>
  filter(is_state, subgroup == "multiracial", grade_level == "TOTAL") |>
  mutate(pct = round(pct * 100, 1)) |>
  select(end_year, n_students, pct) |>
  arrange(end_year)

stopifnot(nrow(multi) > 0)
multi
```

```{r multiracial-chart}
ggplot(multi, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#9370DB") +
  geom_point(size = 3, color = "#9370DB") +
  scale_y_continuous(labels = scales::comma) +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Multiracial Student Enrollment in Alabama",
    subtitle = "Up 66% in four years (25,456 to 42,305)",
    x = "School Year",
    y = "Number of Students"
  )
```

---

## 10. English Learners grew 52% in four years

Alabama's English Learner population surged from 33,595 (4.6%) to 51,068 (7.1%), closely tracking the growth in Hispanic enrollment and reflecting the state's demographic transformation.

```{r el-trend}
el_trend <- enr |>
  filter(is_state, subgroup == "lep", grade_level == "TOTAL") |>
  mutate(pct = round(pct * 100, 1)) |>
  select(end_year, n_students, pct) |>
  arrange(end_year)

stopifnot(nrow(el_trend) > 0)
el_trend
```

```{r el-chart}
ggplot(el_trend, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#4169E1") +
  geom_point(size = 3, color = "#4169E1") +
  scale_y_continuous(labels = scales::comma) +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "English Learner Enrollment in Alabama",
    subtitle = "52% growth: 33,595 to 51,068 students",
    x = "School Year",
    y = "Number of EL Students"
  )
```

---

## 11. Special Ed spiked to 18% then fell back to 14.5%

Special education enrollment jumped from 14% to 18% between 2021 and 2024, then dropped to 14.5% in 2025. The spike may reflect expanded eligibility or pandemic-related identification, with the recent decline suggesting a correction.

```{r sped-trend}
sped <- enr |>
  filter(is_state, subgroup == "special_ed", grade_level == "TOTAL") |>
  mutate(pct = round(pct * 100, 1)) |>
  select(end_year, n_students, pct) |>
  arrange(end_year)

stopifnot(nrow(sped) > 0)
sped
```

```{r sped-chart}
ggplot(sped, aes(x = end_year, y = pct)) +
  geom_line(linewidth = 1.2, color = "#8B4513") +
  geom_point(size = 3, color = "#8B4513") +
  geom_hline(yintercept = 14.4, linetype = "dashed", color = "gray50") +
  annotate("text", x = 2021.5, y = 14.8, label = "National avg (~14.4%)", color = "gray50") +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Students with Disabilities in Alabama",
    subtitle = "Spiked to 18% in 2022-2024, then fell to 14.5% in 2025",
    x = "School Year",
    y = "Percent of Total Enrollment"
  )
```

---

## 12. 3rd grade is the largest class in Alabama

With 57,054 students, 3rd grade edges out 1st grade (56,798) and kindergarten (55,467) as the most enrolled grade level in 2025.

```{r grade-distribution}
grade_dist <- enr_2025 |>
  filter(is_state, subgroup == "total_enrollment",
         grade_level %in% c("K", "01", "02", "03", "04", "05",
                            "06", "07", "08", "09", "10", "11", "12")) |>
  mutate(grade_level = factor(grade_level,
                              levels = c("K", "01", "02", "03", "04", "05",
                                        "06", "07", "08", "09", "10", "11", "12"))) |>
  select(grade_level, n_students) |>
  arrange(grade_level)

stopifnot(nrow(grade_dist) > 0)
grade_dist
```

```{r grade-chart}
ggplot(grade_dist, aes(x = grade_level, y = n_students)) +
  geom_col(fill = "#9B1B30") +
  geom_col(data = grade_dist |> filter(grade_level == "03"),
           fill = "#FF6347") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Enrollment by Grade Level (2025)",
    subtitle = "3rd grade has the most students; 12th grade has the fewest",
    x = "Grade Level",
    y = "Number of Students"
  )
```

---

## 13. Mobile County: 73% low-income, 51% Black

Mobile County's demographics are dramatically different from statewide averages. Its economically disadvantaged rate (73%) is 14 points above the state average, and its Black student population (51%) is 19 points above the statewide share.

```{r mobile-demographics}
mobile_demo <- enr_2025 |>
  filter(is_district, grade_level == "TOTAL",
         grepl("Mobile County", district_name),
         subgroup %in% c("white", "black", "hispanic",
                         "econ_disadv", "total_enrollment")) |>
  mutate(pct = round(pct * 100, 1)) |>
  select(subgroup, n_students, pct) |>
  arrange(desc(n_students))

stopifnot(nrow(mobile_demo) > 0)
mobile_demo
```

---

## 14. Charter schools are Alabama's smallest districts

Alabama's charter sector is small but growing. The smallest 10 districts by enrollment are dominated by charter and specialty schools, with Freedom Prep Academy enrolling just 36 students.

```{r smallest-districts}
smallest <- enr_2025 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  arrange(n_students) |>
  head(10) |>
  select(district_name, n_students)

stopifnot(nrow(smallest) > 0)
smallest
```

```{r smallest-chart}
smallest |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name)) +
  geom_col(fill = "#556B2F") +
  scale_x_continuous(labels = scales::comma) +
  labs(
    title = "Alabama's 10 Smallest School Systems (2025)",
    subtitle = "Charter and specialty schools dominate the smallest districts",
    x = "Total Enrollment",
    y = NULL
  )
```

---

## 15. Middle school enrollment is shrinking while elementary grows

Elementary (K-5) and high school (9-12) enrollment both grew since 2021, but middle school (6-8) dropped from 173,548 to 163,076 -- a loss of over 10,000 students.

```{r grade-band-trends}
grade_bands <- enr |>
  filter(is_state, subgroup == "total_enrollment",
         grade_level %in% c("K", "01", "02", "03", "04", "05",
                            "06", "07", "08",
                            "09", "10", "11", "12")) |>
  mutate(band = case_when(
    grade_level %in% c("K", "01", "02", "03", "04", "05") ~ "Elementary (K-5)",
    grade_level %in% c("06", "07", "08") ~ "Middle (6-8)",
    grade_level %in% c("09", "10", "11", "12") ~ "High School (9-12)"
  )) |>
  group_by(end_year, band) |>
  summarize(n_students = sum(n_students), .groups = "drop")

stopifnot(nrow(grade_bands) > 0)
grade_bands
```

```{r grade-band-chart}
ggplot(grade_bands, aes(x = end_year, y = n_students, color = band)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(values = c("Elementary (K-5)" = "#4169E1",
                                 "Middle (6-8)" = "#2E8B57",
                                 "High School (9-12)" = "#9B1B30")) +
  scale_x_continuous(breaks = 2021:2025) +
  labs(
    title = "Enrollment by Grade Band (2021-2025)",
    subtitle = "Middle school enrollment fell by 10,000 while elementary grew",
    x = "School Year",
    y = "Enrollment",
    color = "Grade Band"
  )
```

---

## Summary

Alabama's school enrollment data reveals a state in rapid transition:

- **Declining overall enrollment** masks dramatic shifts underneath
- **Hispanic and multiracial growth** is reshaping Alabama's student demographics
- **Virtual school explosion** from 12,741 to 19,963 students
- **Black Belt collapse** with Perry County losing 32% of students in 4 years
- **Birmingham City** dropped from top-5 to 8th-largest district
- **Mobile County** still largest but lost 5,768 students since 2021

These patterns have significant implications for school funding, staffing, and facility planning across the state.

---

*Data sourced from the Alabama State Department of Education [Federal Report Card](https://www.alsde.edu/).*

---

```{r session-info}
sessionInfo()
```
